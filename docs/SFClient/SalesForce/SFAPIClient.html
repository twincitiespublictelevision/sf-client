<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="robots" content="index, follow, all" />
    <title>SFClient\SalesForce\SFAPIClient | API</title>

            <link rel="stylesheet" type="text/css" href="../../css/normalize.css">
        <link rel="stylesheet" type="text/css" href="../../css/min.css">
        <link rel="stylesheet" type="text/css" href="../../css/prism.css">
        <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,700,400italic' rel='stylesheet' type='text/css'>
        <script src="../../js/prism.js"></script>
        <meta name="MobileOptimized" content="width">
        <meta name="HandheldFriendly" content="true">
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    
    
    </head>

    <body id="class" data-name="class:SFClient_SalesForce_SFAPIClient" data-root-path="../../">
            <nav>
    <div class="container">
      <div class="title">
        <a href="../../index.html">API</a>
      </div>
      <ul>
        <li><a href="../../classes.html">Classes</a></li>
                  <li><a href="../../namespaces.html">Namespaces</a></li>
                <li><a href="../../interfaces.html">Interfaces</a></li>
        <li><a href="../../traits.html">Traits</a></li>
        <li><a href="../../doc-index.html">Index</a></li>
        <li><a href="../../search.html">Search</a></li>
      </ul>
                  <ol class="breadcrumb">
                                  <li><a href="../../SFClient.html">SFClient</a></li>
                    <li><a href="../../SFClient/SalesForce.html">SalesForce</a></li>
  
            <li>SFAPIClient</li>
        </ol>
        </div>
  </nav>

  <div class="container">
    <div class="row">
        <div id="control-panel">
      </div>

        <div id="api-tree"></div>

    </div>
    <div class="row">
          <h1>SFAPIClient</h1>

    <p>    class
    <strong>SFAPIClient</strong>
</p>

            <p>Class SFAPIClient</p>        <p>A general purpose client for communicating with the SalesForce API. This
client only implements the base functionality for handling CRUD operations as
where as arbitrary query execution.</p>

<p>On construction a client will attempt to authenticate against the supplied
SalesForce endpoint immediately. An exception will be thrown if this call
is not successful. At this point the returned token is stored for later use,
and the credentials for authentication are thrown away.</p>

<p>The client will not attempt to re-authenticate if later API calls generate
authentication failures. If the client is left in use by a long running
process that outlives the lifetime of the access token, then this case may
occur. It is left to the consumer of the client to handle these cases.</p>    
    
            <h2>Constants</h2>

            <table class="table">
                    <tr>
                <td><code class="language-php">OBJECT_API =  &#039;sobjects&#039;;</code></td>
                <td>
                    <p><em></em></p>
                    <p></p>
                </td>
            </tr>
                    <tr>
                <td><code class="language-php">RETRY_STATUSES =  [ 400, 404, 415, 500 ];</code></td>
                <td>
                    <p><em></em></p>
                    <p></p>
                </td>
            </tr>
            </table>

    
            <h2>Properties</h2>

            <table class="table">
                    <tr>
                <td id="property__client">
                    <code class="language-php">                    protected                                        <abbr title="GuzzleHttp\Client">Client</abbr></code>
                </td>
                <td><code class="language-php">$_client</code></td>
                <td></td>
                <td></td>
            </tr>
                    <tr>
                <td id="property__token">
                    <code class="language-php">                    protected                                        string</code>
                </td>
                <td><code class="language-php">$_token</code></td>
                <td></td>
                <td></td>
            </tr>
            </table>

    
            <h2>Methods</h2>

            <table class="table">
            <tr>
            <td>
                <code class="language-php">
                                                            public                    static                </code>
            </td>
            <td class="text-right"><code class="language-php"><a href="../../SFClient/SalesForce/SFAPIClient.html"><abbr title="SFClient\SalesForce\SFAPIClient">SFAPIClient</abbr></a></code></td>
            <td>
                <code class="language-php"><a href="#method_connect">connect</a>(<a href="../../SFClient/Endpoint/Endpoint.html"><abbr title="SFClient\Endpoint\Endpoint">Endpoint</abbr></a> $endpoint, <a href="../../SFClient/Auth/Authentication.html"><abbr title="SFClient\Auth\Authentication">Authentication</abbr></a> $auth)</code>
            </td>
            <td>
                                    Constructs a new SalesForce API client with a given SalesForce API endpoint
and authentication mechanism.            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                    static                </code>
            </td>
            <td class="text-right"><code class="language-php"><a href="../../SFClient/SalesForce/SFAPIClient.html"><abbr title="SFClient\SalesForce\SFAPIClient">SFAPIClient</abbr></a></code></td>
            <td>
                <code class="language-php"><a href="#method_connectWith">connectWith</a>(<abbr title="GuzzleHttp\Client">Client</abbr> $client, <a href="../../SFClient/Auth/Authentication.html"><abbr title="SFClient\Auth\Authentication">Authentication</abbr></a> $auth)</code>
            </td>
            <td>
                                    Constructs a new SalesForce API client with a custom Http client and the
given authentication mechanism.            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"><a href="../../SFClient/SalesForce/ScopedSFAPIClient.html"><abbr title="SFClient\SalesForce\ScopedSFAPIClient">ScopedSFAPIClient</abbr></a></code></td>
            <td>
                <code class="language-php"><a href="#method_scope">scope</a>(string $objectType)</code>
            </td>
            <td>
                                    Constructs a new SalesForce API client that is scoped to a specific object
type.            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"><a href="../../SFClient/Result/SFCreationResult.html"><abbr title="SFClient\Result\SFCreationResult">SFCreationResult</abbr></a></code></td>
            <td>
                <code class="language-php"><a href="#method_create">create</a>(string $objectType, array $data)</code>
            </td>
            <td>
                                    Performs a create operation for a given type.            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"><a href="../../SFClient/Result/SFObjectResult.html"><abbr title="SFClient\Result\SFObjectResult">SFObjectResult</abbr></a></code></td>
            <td>
                <code class="language-php"><a href="#method_get">get</a>(string $objectType, string $id, array $fields = [], $timeout = 10)</code>
            </td>
            <td>
                                    Fetches a single object of a given type.            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"><a href="../../SFClient/Result/BoolResult.html"><abbr title="SFClient\Result\BoolResult">BoolResult</abbr></a></code></td>
            <td>
                <code class="language-php"><a href="#method_patch">patch</a>(string $objectType, string $id, array $data)</code>
            </td>
            <td>
                                    Updates a single object of a given type with the given id.            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"><a href="../../SFClient/Result/BoolResult.html"><abbr title="SFClient\Result\BoolResult">BoolResult</abbr></a></code></td>
            <td>
                <code class="language-php"><a href="#method_delete">delete</a>(string $objectType, string $id)</code>
            </td>
            <td>
                                    Deletes a single object of a given type with the given id.            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"><a href="../../SFClient/Result/SFRecordsResult.html"><abbr title="SFClient\Result\SFRecordsResult">SFRecordsResult</abbr></a></code></td>
            <td>
                <code class="language-php"><a href="#method_query">query</a>(string $query)</code>
            </td>
            <td>
                                    Performs an arbitrary query against the SalesForce query endpoint and
returns the results.            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"><a href="../../SFClient/Result/SFRecordsResult.html"><abbr title="SFClient\Result\SFRecordsResult">SFRecordsResult</abbr></a></code></td>
            <td>
                <code class="language-php"><a href="#method_fullQuery">fullQuery</a>(string $query)</code>
            </td>
            <td>
                                    Performs an multiple queries against the SalesForce query endpoint to
capture all results for a given query.            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php">string</code></td>
            <td>
                <code class="language-php"><a href="#method_o">o</a>(string $objectType, string $id = &#039;&#039;)</code>
            </td>
            <td>
                                    Helper function for constructing a SalesForce Object REST uri.            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"><abbr title="GuzzleHttp\Psr7\Request">Request</abbr></code></td>
            <td>
                <code class="language-php"><a href="#method_authenticatedRequest">authenticatedRequest</a>(<abbr title="GuzzleHttp\Psr7\Request">Request</abbr> $request)</code>
            </td>
            <td>
                                    Given an arbitrary request, returns a new request with the client stored
authentication information attached.            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            public                                    </code>
            </td>
            <td class="text-right"><code class="language-php"><a href="../../SFClient/Result/Result.html"><abbr title="SFClient\Result\Result">Result</abbr></a></code></td>
            <td>
                <code class="language-php"><a href="#method_run">run</a>(<abbr title="GuzzleHttp\Psr7\Request">Request</abbr> $request)</code>
            </td>
            <td>
                                    Executes an arbitrary request against the SalesForce API            </td>
            <td></td>
        </tr>
            <tr>
            <td>
                <code class="language-php">
                                                            protected                                    </code>
            </td>
            <td class="text-right"><code class="language-php">mixed</code></td>
            <td>
                <code class="language-php"><a href="#method__send">_send</a>(<abbr title="GuzzleHttp\Psr7\Request">Request</abbr> $request)</code>
            </td>
            <td>
                                    No description
                            </td>
            <td></td>
        </tr>
        </table>


        <h2>Details</h2>

            <div id="method-details">
                        <div>
        <div class="float-right">
                            at line <a href="#source.75">75</a>
                    </div>
        <div>
            <h3 id="method_connect"><code class="language-php">connect()</code></h3>
            <code class="language-php">public static <a href="../../SFClient/SalesForce/SFAPIClient.html"><abbr title="SFClient\SalesForce\SFAPIClient">SFAPIClient</abbr></a>&nbsp;connect(<a href="../../SFClient/Endpoint/Endpoint.html"><abbr title="SFClient\Endpoint\Endpoint">Endpoint</abbr></a> $endpoint, <a href="../../SFClient/Auth/Authentication.html"><abbr title="SFClient\Auth\Authentication">Authentication</abbr></a> $auth)</code>
        </div>
    </div>

    <div class="details">
                    <div>
                                    <p>Constructs a new SalesForce API client with a given SalesForce API endpoint
and authentication mechanism.</p>                                </div>
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td><code class="language-php"><a href="../../SFClient/Endpoint/Endpoint.html"><abbr title="SFClient\Endpoint\Endpoint">Endpoint</abbr></a></code></td>
                <td><code class="language-php">$endpoint</code></td>
                <td>SalesForce endpoint to make calls against</td>
            </tr>
                    <tr>
                <td><code class="language-php"><a href="../../SFClient/Auth/Authentication.html"><abbr title="SFClient\Auth\Authentication">Authentication</abbr></a></code></td>
                <td><code class="language-php">$auth</code></td>
                <td>SalesForce authentication mechanism</td>
            </tr>
            </table>

        
                    <h4>Return Value</h4>

                <table class="table">
        <tr>
            <td><code class="language-php"><a href="../../SFClient/SalesForce/SFAPIClient.html"><abbr title="SFClient\SalesForce\SFAPIClient">SFAPIClient</abbr></a></code></td>
            <td></td>
        </tr>
    </table>

        
                    <h4>Exceptions</h4>

                <table class="table">
                    <tr>
                <td><a href="../../SFClient/Exceptions/FailedToAuthenticate.html"><abbr title="SFClient\Exceptions\FailedToAuthenticate">FailedToAuthenticate</abbr></a></td>
                <td></td>
            </tr>
                    <tr>
                <td><abbr title="GuzzleHttp\Exception\GuzzleException">GuzzleException</abbr></td>
                <td></td>
            </tr>
            </table>

        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.111">111</a>
                    </div>
        <div>
            <h3 id="method_connectWith"><code class="language-php">connectWith()</code></h3>
            <code class="language-php">public static <a href="../../SFClient/SalesForce/SFAPIClient.html"><abbr title="SFClient\SalesForce\SFAPIClient">SFAPIClient</abbr></a>&nbsp;connectWith(<abbr title="GuzzleHttp\Client">Client</abbr> $client, <a href="../../SFClient/Auth/Authentication.html"><abbr title="SFClient\Auth\Authentication">Authentication</abbr></a> $auth)</code>
        </div>
    </div>

    <div class="details">
                    <div>
                                    <p>Constructs a new SalesForce API client with a custom Http client and the
given authentication mechanism.</p>                    <p>It is expected that the caller has correctly configured the Http client
ahead of time with the appropriate
SalesForce base endpoint url.</p>

<pre><code class="php">$auth = new PasswordAuth(
  'key',
  'secret',
  'user',
  'pass'
);

$client = new Client([
  'base_uri' =&gt; 'https://my.endpoint.salesforce.com/services/data/v12.3/'
]);

$sfClient = SFAPIClient::connectWith($client, $auth);
</code></pre>
</p>            </div>
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td><code class="language-php"><abbr title="GuzzleHttp\Client">Client</abbr></code></td>
                <td><code class="language-php">$client</code></td>
                <td>Http client that will be used by the SFAPIClient to communicate with the SalesForce API</td>
            </tr>
                    <tr>
                <td><code class="language-php"><a href="../../SFClient/Auth/Authentication.html"><abbr title="SFClient\Auth\Authentication">Authentication</abbr></a></code></td>
                <td><code class="language-php">$auth</code></td>
                <td>SalesForce authentication mechanism</td>
            </tr>
            </table>

        
                    <h4>Return Value</h4>

                <table class="table">
        <tr>
            <td><code class="language-php"><a href="../../SFClient/SalesForce/SFAPIClient.html"><abbr title="SFClient\SalesForce\SFAPIClient">SFAPIClient</abbr></a></code></td>
            <td></td>
        </tr>
    </table>

        
                    <h4>Exceptions</h4>

                <table class="table">
                    <tr>
                <td><a href="../../SFClient/Exceptions/FailedToAuthenticate.html"><abbr title="SFClient\Exceptions\FailedToAuthenticate">FailedToAuthenticate</abbr></a></td>
                <td></td>
            </tr>
                    <tr>
                <td><abbr title="GuzzleHttp\Exception\GuzzleException">GuzzleException</abbr></td>
                <td></td>
            </tr>
            </table>

        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.140">140</a>
                    </div>
        <div>
            <h3 id="method_scope"><code class="language-php">scope()</code></h3>
            <code class="language-php">public <a href="../../SFClient/SalesForce/ScopedSFAPIClient.html"><abbr title="SFClient\SalesForce\ScopedSFAPIClient">ScopedSFAPIClient</abbr></a>&nbsp;scope(string $objectType)</code>
        </div>
    </div>

    <div class="details">
                    <div>
                                    <p>Constructs a new SalesForce API client that is scoped to a specific object
type.</p>                    <p>Note that this re-uses the Http client of the SalesForce API client
that was used to create the scoped client. Object types passed to the
method are not validated in any way.</p>

<pre><code class="php">$contacts = $client-&gt;scope('Contact');
</code></pre>
</p>            </div>
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td><code class="language-php">string</code></td>
                <td><code class="language-php">$objectType</code></td>
                <td>SalesForce object type to create a client for</td>
            </tr>
            </table>

        
                    <h4>Return Value</h4>

                <table class="table">
        <tr>
            <td><code class="language-php"><a href="../../SFClient/SalesForce/ScopedSFAPIClient.html"><abbr title="SFClient\SalesForce\ScopedSFAPIClient">ScopedSFAPIClient</abbr></a></code></td>
            <td></td>
        </tr>
    </table>

        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.151">151</a>
                    </div>
        <div>
            <h3 id="method_create"><code class="language-php">create()</code></h3>
            <code class="language-php">public <a href="../../SFClient/Result/SFCreationResult.html"><abbr title="SFClient\Result\SFCreationResult">SFCreationResult</abbr></a>&nbsp;create(string $objectType, array $data)</code>
        </div>
    </div>

    <div class="details">
                    <div>
                                    <p>Performs a create operation for a given type.</p>                                </div>
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td><code class="language-php">string</code></td>
                <td><code class="language-php">$objectType</code></td>
                <td>SalesForce object type to create</td>
            </tr>
                    <tr>
                <td><code class="language-php">array</code></td>
                <td><code class="language-php">$data</code></td>
                <td>Field data to create the object with</td>
            </tr>
            </table>

        
                    <h4>Return Value</h4>

                <table class="table">
        <tr>
            <td><code class="language-php"><a href="../../SFClient/Result/SFCreationResult.html"><abbr title="SFClient\Result\SFCreationResult">SFCreationResult</abbr></a></code></td>
            <td></td>
        </tr>
    </table>

        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.186">186</a>
                    </div>
        <div>
            <h3 id="method_get"><code class="language-php">get()</code></h3>
            <code class="language-php">public <a href="../../SFClient/Result/SFObjectResult.html"><abbr title="SFClient\Result\SFObjectResult">SFObjectResult</abbr></a>&nbsp;get(string $objectType, string $id, array $fields = [], $timeout = 10)</code>
        </div>
    </div>

    <div class="details">
                    <div>
                                    <p>Fetches a single object of a given type.</p>                    <p>The optional <code>$fields</code> argument may be used to restrict the fields that
are returned. By default all fields are returned.</p>            </div>
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td><code class="language-php">string</code></td>
                <td><code class="language-php">$objectType</code></td>
                <td></td>
            </tr>
                    <tr>
                <td><code class="language-php">string</code></td>
                <td><code class="language-php">$id</code></td>
                <td></td>
            </tr>
                    <tr>
                <td><code class="language-php">array</code></td>
                <td><code class="language-php">$fields</code></td>
                <td></td>
            </tr>
                    <tr>
                <td></td>
                <td><code class="language-php">$timeout</code></td>
                <td></td>
            </tr>
            </table>

        
                    <h4>Return Value</h4>

                <table class="table">
        <tr>
            <td><code class="language-php"><a href="../../SFClient/Result/SFObjectResult.html"><abbr title="SFClient\Result\SFObjectResult">SFObjectResult</abbr></a></code></td>
            <td></td>
        </tr>
    </table>

        
                    <h4>Exceptions</h4>

                <table class="table">
                    <tr>
                <td><a target="_blank" href="http://php.net/Exception"><abbr title="Exception">Exception</abbr></a></td>
                <td></td>
            </tr>
            </table>

        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.223">223</a>
                    </div>
        <div>
            <h3 id="method_patch"><code class="language-php">patch()</code></h3>
            <code class="language-php">public <a href="../../SFClient/Result/BoolResult.html"><abbr title="SFClient\Result\BoolResult">BoolResult</abbr></a>&nbsp;patch(string $objectType, string $id, array $data)</code>
        </div>
    </div>

    <div class="details">
                    <div>
                                    <p>Updates a single object of a given type with the given id.</p>                                </div>
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td><code class="language-php">string</code></td>
                <td><code class="language-php">$objectType</code></td>
                <td>SalesForce object type to update</td>
            </tr>
                    <tr>
                <td><code class="language-php">string</code></td>
                <td><code class="language-php">$id</code></td>
                <td>SalesForce id type to update</td>
            </tr>
                    <tr>
                <td><code class="language-php">array</code></td>
                <td><code class="language-php">$data</code></td>
                <td>Field data to update the object with</td>
            </tr>
            </table>

        
                    <h4>Return Value</h4>

                <table class="table">
        <tr>
            <td><code class="language-php"><a href="../../SFClient/Result/BoolResult.html"><abbr title="SFClient\Result\BoolResult">BoolResult</abbr></a></code></td>
            <td></td>
        </tr>
    </table>

        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.251">251</a>
                    </div>
        <div>
            <h3 id="method_delete"><code class="language-php">delete()</code></h3>
            <code class="language-php">public <a href="../../SFClient/Result/BoolResult.html"><abbr title="SFClient\Result\BoolResult">BoolResult</abbr></a>&nbsp;delete(string $objectType, string $id)</code>
        </div>
    </div>

    <div class="details">
                    <div>
                                    <p>Deletes a single object of a given type with the given id.</p>                                </div>
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td><code class="language-php">string</code></td>
                <td><code class="language-php">$objectType</code></td>
                <td>SalesForce object type to delete</td>
            </tr>
                    <tr>
                <td><code class="language-php">string</code></td>
                <td><code class="language-php">$id</code></td>
                <td>SalesForce id type to delete</td>
            </tr>
            </table>

        
                    <h4>Return Value</h4>

                <table class="table">
        <tr>
            <td><code class="language-php"><a href="../../SFClient/Result/BoolResult.html"><abbr title="SFClient\Result\BoolResult">BoolResult</abbr></a></code></td>
            <td></td>
        </tr>
    </table>

        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.285">285</a>
                    </div>
        <div>
            <h3 id="method_query"><code class="language-php">query()</code></h3>
            <code class="language-php">public <a href="../../SFClient/Result/SFRecordsResult.html"><abbr title="SFClient\Result\SFRecordsResult">SFRecordsResult</abbr></a>&nbsp;query(string $query)</code>
        </div>
    </div>

    <div class="details">
                    <div>
                                    <p>Performs an arbitrary query against the SalesForce query endpoint and
returns the results.</p>                    <p>The results returned may not represent all of the objects in SalesForce
that match the given query. Records up to the limit set by SalesForce are
returned.</p>

<p>This method runs the provided query as-is and does not perform validation
or sanitizion. Consumers of the client should handle these operations prior
to passing the query to the client.</p>            </div>
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td><code class="language-php">string</code></td>
                <td><code class="language-php">$query</code></td>
                <td>A SOQL query to run</td>
            </tr>
            </table>

        
                    <h4>Return Value</h4>

                <table class="table">
        <tr>
            <td><code class="language-php"><a href="../../SFClient/Result/SFRecordsResult.html"><abbr title="SFClient\Result\SFRecordsResult">SFRecordsResult</abbr></a></code></td>
            <td></td>
        </tr>
    </table>

        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.318">318</a>
                    </div>
        <div>
            <h3 id="method_fullQuery"><code class="language-php">fullQuery()</code></h3>
            <code class="language-php">public <a href="../../SFClient/Result/SFRecordsResult.html"><abbr title="SFClient\Result\SFRecordsResult">SFRecordsResult</abbr></a>&nbsp;fullQuery(string $query)</code>
        </div>
    </div>

    <div class="details">
                    <div>
                                    <p>Performs an multiple queries against the SalesForce query endpoint to
capture all results for a given query.</p>                    <p>This method utilizies the built in SalesForce query response pagination and
should reflect the behavior of following the next page urls.</p>

<p>If any of the requests fail, the entire query attempt will fail and will
return the erro of the failure.</p>

<p>This method runs the provided query as-is and does not perform validation
or sanitizion. Consumers of the client should handle these operations prior
to passing the query to the client.</p>            </div>
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td><code class="language-php">string</code></td>
                <td><code class="language-php">$query</code></td>
                <td>A SOQL query to run</td>
            </tr>
            </table>

        
                    <h4>Return Value</h4>

                <table class="table">
        <tr>
            <td><code class="language-php"><a href="../../SFClient/Result/SFRecordsResult.html"><abbr title="SFClient\Result\SFRecordsResult">SFRecordsResult</abbr></a></code></td>
            <td></td>
        </tr>
    </table>

        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.359">359</a>
                    </div>
        <div>
            <h3 id="method_o"><code class="language-php">o()</code></h3>
            <code class="language-php">public string&nbsp;o(string $objectType, string $id = &#039;&#039;)</code>
        </div>
    </div>

    <div class="details">
                    <div>
                                    <p>Helper function for constructing a SalesForce Object REST uri.</p>                                </div>
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td><code class="language-php">string</code></td>
                <td><code class="language-php">$objectType</code></td>
                <td></td>
            </tr>
                    <tr>
                <td><code class="language-php">string</code></td>
                <td><code class="language-php">$id</code></td>
                <td></td>
            </tr>
            </table>

        
                    <h4>Return Value</h4>

                <table class="table">
        <tr>
            <td><code class="language-php">string</code></td>
            <td></td>
        </tr>
    </table>

        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.371">371</a>
                    </div>
        <div>
            <h3 id="method_authenticatedRequest"><code class="language-php">authenticatedRequest()</code></h3>
            <code class="language-php">public <abbr title="GuzzleHttp\Psr7\Request">Request</abbr>&nbsp;authenticatedRequest(<abbr title="GuzzleHttp\Psr7\Request">Request</abbr> $request)</code>
        </div>
    </div>

    <div class="details">
                    <div>
                                    <p>Given an arbitrary request, returns a new request with the client stored
authentication information attached.</p>                                </div>
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td><code class="language-php"><abbr title="GuzzleHttp\Psr7\Request">Request</abbr></code></td>
                <td><code class="language-php">$request</code></td>
                <td></td>
            </tr>
            </table>

        
                    <h4>Return Value</h4>

                <table class="table">
        <tr>
            <td><code class="language-php"><abbr title="GuzzleHttp\Psr7\Request">Request</abbr></code></td>
            <td></td>
        </tr>
    </table>

        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.391">391</a>
                    </div>
        <div>
            <h3 id="method_run"><code class="language-php">run()</code></h3>
            <code class="language-php">public <a href="../../SFClient/Result/Result.html"><abbr title="SFClient\Result\Result">Result</abbr></a>&nbsp;run(<abbr title="GuzzleHttp\Psr7\Request">Request</abbr> $request)</code>
        </div>
    </div>

    <div class="details">
                    <div>
                                    <p>Executes an arbitrary request against the SalesForce API</p>                                </div>
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td><code class="language-php"><abbr title="GuzzleHttp\Psr7\Request">Request</abbr></code></td>
                <td><code class="language-php">$request</code></td>
                <td></td>
            </tr>
            </table>

        
                    <h4>Return Value</h4>

                <table class="table">
        <tr>
            <td><code class="language-php"><a href="../../SFClient/Result/Result.html"><abbr title="SFClient\Result\Result">Result</abbr></a></code></td>
            <td></td>
        </tr>
    </table>

        
        
            </div>

                        <div>
        <div class="float-right">
                            at line <a href="#source.406">406</a>
                    </div>
        <div>
            <h3 id="method__send"><code class="language-php">_send()</code></h3>
            <code class="language-php">protected mixed&nbsp;_send(<abbr title="GuzzleHttp\Psr7\Request">Request</abbr> $request)</code>
        </div>
    </div>

    <div class="details">
                            <h4>Parameters</h4>

                <table class="table">
                    <tr>
                <td><code class="language-php"><abbr title="GuzzleHttp\Psr7\Request">Request</abbr></code></td>
                <td><code class="language-php">$request</code></td>
                <td></td>
            </tr>
            </table>

        
                    <h4>Return Value</h4>

                <table class="table">
        <tr>
            <td><code class="language-php">mixed</code></td>
            <td></td>
        </tr>
    </table>

        
                    <h4>Exceptions</h4>

                <table class="table">
                    <tr>
                <td><abbr title="GuzzleHttp\Exception\GuzzleException">GuzzleException</abbr></td>
                <td></td>
            </tr>
            </table>

        
            </div>

            </div>

    
    <h2>Source code</h2>
    <pre class="language-php line-numbers" id="source"><code>&lt;?php

namespace SFClient\SalesForce;

use GuzzleHttp\Client;
use GuzzleHttp\Exception\RequestException;
use GuzzleHttp\Psr7\Request;
use function SFClient\ex_json_decode;
use function SFClient\ex_json_encode;
use SFClient\Result\BoolResult;
use SFClient\Result\SFCreationResult;
use SFClient\Result\SFObjectResult;
use SFClient\Result\SFRecordsResult;
use SFClient\SalesForce\SFCreation;
use SFClient\SalesForce\SFRecords;
use SFClient\SalesForce\SFObject;
use SFClient\Auth\Authentication;
use SFClient\Endpoint\Endpoint;
use SFClient\Exceptions\FailedToAuthenticate;
use SFClient\Result\Result;

/**
 * Class SFAPIClient
 *
 * A general purpose client for communicating with the SalesForce API. This
 * client only implements the base functionality for handling CRUD operations as
 * where as arbitrary query execution.
 *
 * On construction a client will attempt to authenticate against the supplied
 * SalesForce endpoint immediately. An exception will be thrown if this call
 * is not successful. At this point the returned token is stored for later use,
 * and the credentials for authentication are thrown away.
 *
 * The client will not attempt to re-authenticate if later API calls generate
 * authentication failures. If the client is left in use by a long running
 * process that outlives the lifetime of the access token, then this case may
 * occur. It is left to the consumer of the client to handle these cases.
 *
 * @package SFClient\SalesForce
 */
class SFAPIClient {
  const OBJECT_API = &#039;sobjects&#039;;
  const RETRY_STATUSES = [ 400, 404, 415, 500 ];

  /**
   * @var Client
   */
  protected $_client;

  /**
   * @var string
   */
  protected $_token;

  /**
   * SFClient constructor.
   * @param Client $client
   * @param string $token
   */
  private function __construct(Client $client, string $token) {
    $this-&gt;_client = $client;
    $this-&gt;_token = $token;
  }

  /**
   * Constructs a new SalesForce API client with a given SalesForce API endpoint
   * and authentication mechanism.
   *
   * @param Endpoint $endpoint SalesForce endpoint to make calls against
   * @param Authentication $auth SalesForce authentication mechanism
   * @return SFAPIClient
   * @throws FailedToAuthenticate
   * @throws \GuzzleHttp\Exception\GuzzleException
   */
  public static function connect(Endpoint $endpoint, Authentication $auth): SFAPIClient {
    $client = new Client([
      &#039;base_uri&#039; =&gt; $endpoint-&gt;getUrl()
    ]);

    return self::connectWith($client, $auth);
  }

  /**
   * Constructs a new SalesForce API client with a custom Http client and the
   * given authentication mechanism.
   *
   * It is expected that the caller has correctly configured the Http client
   * ahead of time with the appropriate
   * SalesForce base endpoint url.
   * ```php
   * $auth = new PasswordAuth(
   *   &#039;key&#039;,
   *   &#039;secret&#039;,
   *   &#039;user&#039;,
   *   &#039;pass&#039;
   * );
   *
   * $client = new Client([
   *   &#039;base_uri&#039; =&gt; &#039;https://my.endpoint.salesforce.com/services/data/v12.3/&#039;
   * ]);
   *
   * $sfClient = SFAPIClient::connectWith($client, $auth);
   * ```
   *
   * @param Client $client Http client that will be used by the SFAPIClient to communicate with the SalesForce API
   * @param Authentication $auth SalesForce authentication mechanism
   * @return SFAPIClient
   * @throws FailedToAuthenticate
   * @throws \GuzzleHttp\Exception\GuzzleException
   */
  public static function connectWith(Client $client, Authentication $auth): SFAPIClient {
    $token = $auth-&gt;getTokenFromResponse(
      $client-&gt;send($auth-&gt;getTokenRequest())
    );

    if ($token === null) {
      throw new FailedToAuthenticate();
    }

    return new SFAPIClient(
      $client,
      $token
    );
  }

  /**
   * Constructs a new SalesForce API client that is scoped to a specific object
   * type.
   *
   * Note that this re-uses the Http client of the SalesForce API client
   * that was used to create the scoped client. Object types passed to the
   * method are not validated in any way.
   * ```php
   * $contacts = $client-&gt;scope(&#039;Contact&#039;);
   * ```
   *
   * @param string $objectType SalesForce object type to create a client for
   * @return ScopedSFAPIClient
   */
  public function scope(string $objectType): ScopedSFAPIClient {
    return new ScopedSFAPIClient($this, $objectType);
  }

  /**
   * Performs a create operation for a given type.
   *
   * @param string $objectType SalesForce object type to create
   * @param array $data Field data to create the object with
   * @return SFCreationResult
   */
  public function create(string $objectType, array $data): SFCreationResult {
    $result = $this-&gt;run(
      new Request(
        &#039;POST&#039;,
        $this-&gt;o($objectType, &#039;&#039;),
        [&#039;content-type&#039; =&gt; &#039;application/json&#039;],
        ex_json_encode($data)
      )
    );

    if ($result-&gt;isError()) {
      return SFCreationResult::err($result-&gt;getErr());
    }

    $response = $result-&gt;value();

    if ($response &amp;&amp; $response instanceof \stdClass) {
      return SFCreationResult::ok(new SFCreation($response));
    }

    return SFCreationResult::err(new \Exception(&#039;Failed to handle create response&#039;));
  }

  /**
   * Fetches a single object of a given type.
   *
   * The optional `$fields` argument may be used to restrict the fields that
   * are returned. By default all fields are returned.
   *
   * @param string $objectType SalesForce object type to query for
   * @param string $id SalesForce object id to query for
   * @param array $fields SalesForce fields to return
   * @return SFObjectResult
   * @throws \Exception
   */
  public function get(string $objectType, string $id, array $fields = [], $timeout = 10): SFObjectResult {
    $fieldQuery = empty($fields) ? &#039;&#039; : &#039;?fields=&#039; . implode(&#039;,&#039;, $fields);
    $result = $this-&gt;run(new Request(&#039;GET&#039;, $this-&gt;o($objectType, $id) . $fieldQuery));

    if ($result-&gt;isError()) {
      $error = $result-&gt;getErr();

      if ($error instanceof RequestException &amp;&amp; $error-&gt;getResponse()) {
        $errorcode = $error-&gt;getResponse()-&gt;getStatusCode();
        if (in_array($errorcode, self::RETRY_STATUSES) &amp;&amp; $timeout &lt; 1000) {
          usleep($timeout);
          return $this-&gt;get($objectType, $id, $fields, $timeout * 10);
        } elseif ($errorcode === 404) {
          return SFObjectResult::ok(null);
        }
      }

      return SFObjectResult::err($result-&gt;getErr());
    }

    $response = $result-&gt;value();

    if ($response &amp;&amp; $response instanceof \stdClass) {
      return SFObjectResult::ok(new SFObject($response));
    }

    return SFObjectResult::err(new \Exception(&#039;Failed to handle get response&#039;));
  }

  /**
   * Updates a single object of a given type with the given id.
   *
   * @param string $objectType SalesForce object type to update
   * @param string $id SalesForce id type to update
   * @param array $data Field data to update the object with
   * @return BoolResult
   */
  public function patch(string $objectType, string $id, array $data): BoolResult {
    $result = $this-&gt;run(
      new Request(
        &#039;PATCH&#039;,
        $this-&gt;o($objectType, $id),
        [&#039;content-type&#039; =&gt; &#039;application/json&#039;],
        ex_json_encode($data)
      )
    );

    if ($result-&gt;isError()) {
      return BoolResult::err($result-&gt;getErr());
    }

    if ($result-&gt;value() === null) {
      return BoolResult::ok(true);
    }

    return BoolResult::ok(false);
  }

  /**
   * Deletes a single object of a given type with the given id.
   *
   * @param string $objectType SalesForce object type to delete
   * @param string $id SalesForce id type to delete
   * @return BoolResult
   */
  public function delete(string $objectType, string $id): BoolResult {
    $result = $this-&gt;run(
      new Request(
        &#039;PATCH&#039;,
        $this-&gt;o($objectType, $id)
      )
    );

    if ($result-&gt;isError()) {
      return BoolResult::err($result-&gt;getErr());
    }

    if ($result-&gt;value() === null) {
      return BoolResult::ok(true);
    }

    return BoolResult::ok(false);
  }

  /**
   * Performs an arbitrary query against the SalesForce query endpoint and
   * returns the results.
   *
   * The results returned may not represent all of the objects in SalesForce
   * that match the given query. Records up to the limit set by SalesForce are
   * returned.
   *
   * This method runs the provided query as-is and does not perform validation
   * or sanitizion. Consumers of the client should handle these operations prior
   * to passing the query to the client.
   *
   * @param string $query A SOQL query to run
   * @return SFRecordsResult
   */
  public function query(string $query): SFRecordsResult {
    $result = $this-&gt;run(new Request(&#039;GET&#039;, &#039;query?q=&#039; . urlencode($query)));

    if ($result-&gt;isError()) {
      return SFRecordsResult::err($result-&gt;getErr());
    }

    $response = $result-&gt;value();

    if ($response &amp;&amp; $response instanceof \stdClass) {
      return SFRecordsResult::ok(new SFRecords($response));
    }

    return SFRecordsResult::err(new \Exception(&#039;Failed to handle query response&#039;));
  }

  /**
   * Performs an multiple queries against the SalesForce query endpoint to
   * capture all results for a given query.
   *
   * This method utilizies the built in SalesForce query response pagination and
   * should reflect the behavior of following the next page urls.
   *
   * If any of the requests fail, the entire query attempt will fail and will
   * return the erro of the failure.
   *
   * This method runs the provided query as-is and does not perform validation
   * or sanitizion. Consumers of the client should handle these operations prior
   * to passing the query to the client.
   *
   * @param string $query A SOQL query to run
   * @return SFRecordsResult
   */
  public function fullQuery(string $query): SFRecordsResult {
    $completeRecords = new \stdClass();
    $completeRecords-&gt;totalSize = 0;
    $completeRecords-&gt;done = true;
    $completeRecords-&gt;records = [];

    $request = new Request(&#039;GET&#039;, &#039;query?q=&#039; . urlencode($query));

    do {
      $result = $this-&gt;run($request);

      try {
        $records = new SFRecords($result-&gt;value());
        $completeRecords-&gt;totalSize = $records-&gt;getTotal();
        $completeRecords-&gt;records = array_merge($completeRecords-&gt;records, $records-&gt;getRecordsRaw());

        if ($records-&gt;getNextRecordsUrl()) {
          $request = new Request(
            &#039;GET&#039;,
            substr($records-&gt;getNextRecordsUrl(), strpos($records-&gt;getNextRecordsUrl(), &quot;query&quot;))
          );
        } else {
          $request = null;
        }

      } catch (\Exception $e) {
        return SFRecordsResult::err($e);
      }
    } while ($records-&gt;hasMore() &amp;&amp; $request);

    return SFRecordsResult::ok(new SFRecords($completeRecords));
  }

  /**
   * Helper function for constructing a SalesForce Object REST uri.
   *
   * @param string $objectType
   * @param string $id
   * @return string
   * @internal
   */
  public function o(string $objectType, string $id = &#039;&#039;): string {
    return self::OBJECT_API . &quot;/{$objectType}&quot; . ($id ? &quot;/${id}&quot; : &#039;&#039;);
  }

  /**
   * Given an arbitrary request, returns a new request with the client stored
   * authentication information attached.
   *
   * @param Request $request
   * @return Request
   * @internal
   */
  public function authenticatedRequest(Request $request): Request {

    /**
     * withAddedHeader belongs to MessageTrait. PHPDoc to hint the returned
     * value is of the same type as the initial value.
     *
     * @var Request $req
     */
    $req = $request-&gt;withAddedHeader(&#039;Authorization&#039;, &quot;Bearer {$this-&gt;_token}&quot;);

    return $req;
  }

  /**
   * Executes an arbitrary request against the SalesForce API
   *
   * @param Request $request
   * @return Result
   * @internal
   */
  public function run(Request $request): Result {
    try {
      return Result::ok($this-&gt;_send(
        $this-&gt;authenticatedRequest($request)
      ));
    } catch (\Exception $e) {
      return Result::err($e);
    }
  }

  /**
   * @param Request $request
   * @return mixed
   * @throws \GuzzleHttp\Exception\GuzzleException
   */
  protected function _send(Request $request) {
    $body = $this-&gt;_client-&gt;send($request)-&gt;getBody();

    if ($body &amp;&amp; $body-&gt;getContents() === &quot;&quot;) {
      return null;
    }

    return ex_json_decode($body);
  }
}</code></pre>
    </div>
    <div class="row">
        <div id="footer">
    Generated by <a href="http://sami.sensiolabs.org/">Sami, the API Documentation Generator</a> using <a href="https://github.com/nochso/sami-theme">nochso/sami-theme</a>.
  </div>

    </div>
  </div>
    </body>

</html>
